# Type Coercion

## Definición

**Type Coercion** es la conversión automática o explícita de valores de un tipo de dato a otro en JavaScript.

JavaScript es un lenguaje de tipado dinámico y débil, lo que significa que puede convertir tipos automáticamente cuando es necesario.

---

## Tipos de Coerción

### 1. Coerción Implícita

Conversión automática realizada por JavaScript.

```js
"5" + 2; // "52" (number → string)
"5" - 2; // 3 (string → number)
"5" * "2"; // 10 (ambos strings → numbers)
true + 1; // 2 (boolean → number)
```

### 2. Coerción Explícita

Conversión manual usando funciones de conversión.

```js
Number("5"); // 5
String(123); // "123"
Boolean(0); // false
parseInt("10px"); // 10
parseFloat("3.14"); // 3.14
```

---

## Conversión a String

### Implícita

Ocurre con el operador `+` cuando uno de los operandos es string:

```js
"Hola" + " Mundo"; // "Hola Mundo"
"5" + 2; // "52"
"" + 123; // "123"
123 + ""; // "123"
```

### Explícita

```js
String(123); // "123"
String(true); // "true"
String(null); // "null"
String(undefined); // "undefined"
(123).toString(); // "123"
```

**Tabla de conversión a String:**

| Valor       | Resultado           |
| ----------- | ------------------- |
| `123`       | `"123"`             |
| `true`      | `"true"`            |
| `false`     | `"false"`           |
| `null`      | `"null"`            |
| `undefined` | `"undefined"`       |
| `[]`        | `""`                |
| `[1,2,3]`   | `"1,2,3"`           |
| `{}`        | `"[object Object]"` |

---

## Conversión a Number

### Implícita

Ocurre con operadores matemáticos (excepto `+`):

```js
"5" - 2; // 3
"5" * "2"; // 10
"10" / 2; // 5
"5" % 2; // 1
+"5"; // 5 (operador unario +)
```

### Explícita

```js
Number("5"); // 5
Number("3.14"); // 3.14
Number(""); // 0
Number("abc"); // NaN
Number(true); // 1
Number(false); // 0
Number(null); // 0
Number(undefined); // NaN

parseInt("10"); // 10
parseInt("10.5"); // 10
parseFloat("10.5"); // 10.5
parseInt("10px"); // 10
```

**Tabla de conversión a Number:**

| Valor       | Number() | parseInt() |
| ----------- | -------- | ---------- |
| `"5"`       | `5`      | `5`        |
| `"3.14"`    | `3.14`   | `3`        |
| `""`        | `0`      | `NaN`      |
| `" "`       | `0`      | `NaN`      |
| `"abc"`     | `NaN`    | `NaN`      |
| `"10px"`    | `NaN`    | `10`       |
| `true`      | `1`      | `NaN`      |
| `false`     | `0`      | `NaN`      |
| `null`      | `0`      | `NaN`      |
| `undefined` | `NaN`    | `NaN`      |
| `[]`        | `0`      | `NaN`      |
| `[5]`       | `5`      | `5`        |
| `[1,2]`     | `NaN`    | `1`        |

---

## Conversión a Boolean

### Implícita

Ocurre en contextos booleanos (if, while, operadores lógicos):

```js
if ("hola") {
} // true
if (0) {
} // false
!!""; // false
!!"texto"; // true
```

### Explícita

```js
Boolean(0); // false
Boolean(1); // true
Boolean(""); // false
Boolean("texto"); // true
```

**Valores Falsy (se convierten a false):**

1. `false`
2. `0`
3. `-0`
4. `""`
5. `null`
6. `undefined`
7. `NaN`

**Valores Truthy (todo lo demás):**

- Strings no vacíos: `"0"`, `"false"`, `" "`
- Números diferentes de 0: `1`, `-1`, `3.14`
- Arrays: `[]`, `[1,2,3]`
- Objetos: `{}`, `{a: 1}`
- Funciones

---

## Casos Especiales y Quirks

### Operador `+`

Comportamiento dual:

```js
// Concatenación si hay un string
"5" + 2; // "52"
2 + "5"; // "25"
"5" + true; // "5true"

// Suma si ambos son números
5 + 2; // 7
true + 1; // 2
```

### Operadores de comparación

```js
// Comparación floja (==) con coerción
5 == "5"; // true
true == 1; // true
false == 0; // true
null == undefined; // true
"" == 0; // true

// Comparación estricta (===) sin coerción
5 === "5"; // false
true === 1; // false
```

### Arrays y objetos

```js
// Arrays se convierten a strings
[] + []; // "" (array vacío → string vacío)
[1] + [2]; // "12"
[1, 2] + [3, 4]; // "1,23,4"

// Objetos se convierten a "[object Object]"
{
}
+{}; // NaN o "[object Object][object Object]"
{
}
+[]; // 0
[] + {}; // "[object Object]"
```

### Valores especiales

```js
// null
null + 1; // 1 (null → 0)
null == 0; // false (quirk)
Number(null); // 0

// undefined
undefined + 1; // NaN
undefined == null; // true (quirk)
Number(undefined); // NaN

// NaN
NaN + 1; // NaN
NaN == NaN; // false
```

---

## Tabla Comparativa de Conversiones

| Operación    | Resultado | Tipo    |
| ------------ | --------- | ------- |
| `"5" + 2`    | `"52"`    | string  |
| `"5" - 2`    | `3`       | number  |
| `"5" * 2`    | `10`      | number  |
| `"5" / 2`    | `2.5`     | number  |
| `5 + true`   | `6`       | number  |
| `"5" + true` | `"5true"` | string  |
| `5 == "5"`   | `true`    | boolean |
| `5 === "5"`  | `false`   | boolean |
| `!"0"`       | `false`   | boolean |
| `!0`         | `true`    | boolean |

---

## Reglas de Conversión

### Para operador `+`

1. Si alguno de los operandos es string → concatenación (convierte a string)
2. Si ambos son números → suma
3. Si hay booleanos → convierte a number primero

### Para operadores matemáticos (`-`, `*`, `/`, `%`)

Convierte ambos operandos a number.

### Para operadores lógicos (`&&`, `||`, `!`)

Convierte a boolean, pero `&&` y `||` devuelven uno de los valores originales.

### Para comparaciones

- `==` y `!=`: permite coerción
- `===` y `!==`: no permite coerción (recomendado)

---

## Métodos de Conversión

### toString()

Convierte a string (no funciona con null/undefined):

```js
(123).toString(); // "123"
true.toString(); // "true"
[1, 2, 3].toString(); // "1,2,3"
```

### valueOf()

Intenta obtener valor primitivo:

```js
let obj = { valueOf: () => 5 };
obj + 2; // 7
```

### Symbol.toPrimitive (ES6)

Control personalizado de conversión:

```js
let obj = {
  [Symbol.toPrimitive](hint) {
    if (hint === "number") return 10;
    if (hint === "string") return "obj";
    return true;
  },
};

+obj; // 10
`${obj}`; // "obj"
obj + ""; // "true"
```

---

## Mejores Prácticas

1. **Usar conversión explícita** cuando sea posible

   ```js
   // Mal
   let num = +"5";

   // Bien
   let num = Number("5");
   ```

2. **Usar `===` en lugar de `==`** para evitar coerción inesperada

   ```js
   // Mal
   if (x == "5") {
   }

   // Bien
   if (x === 5) {
   }
   ```

3. **Validar tipos antes de operar**

   ```js
   if (typeof value === "number") {
     // operar con value
   }
   ```

4. **Tener cuidado con `+` cuando trabajes con strings y números**

   ```js
   // Mal
   let total = value + 10; // si value es "5", resultado es "510"

   // Bien
   let total = Number(value) + 10;
   ```

---

## Resumen

**Type Coercion:**

- Conversión automática (implícita) o manual (explícita) de tipos
- JavaScript es débilmente tipado → realiza coerción frecuentemente
- Operador `+` es especial: puede sumar o concatenar
- Valores falsy: `false`, `0`, `""`, `null`, `undefined`, `NaN`, `-0`
- Todo lo demás es truthy

**Recomendaciones:**

- Preferir conversión explícita (`Number()`, `String()`, `Boolean()`)
- Usar `===` en lugar de `==`
- Validar tipos antes de operar
- Conocer los quirks para evitar bugs

---

Anterior tema: [Associativity](./15.%20Asociativity.md) | Siguiente tema: [Comparison Operators](./17.%20Comparison%20Operators.md) | Volver al índice: [Índice Temático](./README.md)
